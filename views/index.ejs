<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gestor de Bot WhatsApp</title>
  <link rel="stylesheet" href="/css/style.css" />
  <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon" />
</head>
<body>
  <div class="container">
    <header class="header">
      <h1 class="title">🦾 Gestor de Bot WhatsApp</h1>
      <p class="subtitle">Control y monitoreo de mensajes automatizados</p>
    </header>

    <!-- Control principal -->
    <section class="control-section">
      <div class="button-group">
        <input id="session-id" type="text" placeholder="ID de Sesión (opcional)" />
        <button id="start-btn" class="btn btn-success">🚀 Iniciar Bot</button>
        <button id="stop-btn" class="btn btn-danger" disabled>⛔ Detener Bot</button>
        <button id="google-login-btn" class="btn btn-primary">🔍 Importar contactos de Google</button>
      </div>
    </section>

    <!-- QR individual estándar -->
    <section class="qr-section hidden" id="qr-container">
      <div class="qr-header">
        <h2>🔑 Autenticación Requerida</h2>
        <p class="qr-instructions">Escanea este código con WhatsApp &gt; Dispositivos vinculados</p>
      </div>
      <div class="qr-code-container" id="qr-code"></div>
    </section>

    <!-- NUEVA SECCIÓN: Multi-sesiones QR -->
    <section class="multi-qr-section">
      <h2>🧩 Múltiples Bots WhatsApp</h2>
      <button id="add-session-btn" class="btn btn-secondary">➕ Nueva Sesión</button>
      <div id="multi-qr-container" class="multi-qr-grid"></div>
    </section>

    <!-- NUEVA SECCIÓN: Estado de backups y contactos -->
    <section class="backup-status-section">
      <h3>📂 Estado de Backup y Contactos</h3>
      <div class="contact-list-section">
        <h4>✔️ Contactos Importados Exitosamente</h4>
        <div id="successful-numbers" class="contact-list"></div>
      </div>
      <div class="contact-list-section">
        <h4>❌ Números Fallidos</h4>
        <div id="failed-numbers" class="contact-list"></div>
      </div>
    </section>

    <!-- Estadísticas -->
    <section class="stats-section">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">📖</div>
          <div class="stat-content">
            <span class="stat-label">Contactos</span>
            <span id="contact-count" class="stat-value">0</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">✉️</div>
          <div class="stat-content">
            <span class="stat-label">Enviados</span>
            <span id="sent-count" class="stat-value">0</span>
          </div>
        </div>
      </div>
    </section>

    <!-- 📝 Registro de Actividad -->
    <section class="log-section">
      <div class="log-header">
        <h3>📝 Registro de Actividad</h3>
        <div class="log-controls">
          <span class="badge live-indicator">● EN VIVO</span>
        </div>
      </div>
      <div class="log-container" id="activity-log">
        <div class="log-placeholder">
          Esperando actividad del bot...
        </div>
      </div>
    </section>
  </div>

  <!-- Scripts -->
  <script src="/socket.io/socket.io.js"></script>
  <script src="/js/app.js"></script>

  <script>
    const socket = io();
    let sessionCount = 0;

    document.getElementById('add-session-btn').addEventListener('click', () => {
      sessionCount++;
      const sessionId = `session-${Date.now()}-${sessionCount}`;
      createSessionCard(sessionId);
      socket.emit('create-session', { sessionId });
    });

    function createSessionCard(sessionId) {
      const container = document.getElementById('multi-qr-container');
      const card = document.createElement('div');
      card.className = 'qr-session-card';
      card.id = sessionId;
      card.innerHTML = `
        <h4>Sesión ${sessionId}</h4>
        <div class="qr-code" id="qr-${sessionId}">Esperando QR...</div>
        <button class="btn btn-danger" onclick="stopSession('${sessionId}')">Detener</button>
      `;
      container.appendChild(card);
    }

    function stopSession(sessionId) {
      socket.emit('stop-bot', { sessionId });
      document.getElementById(sessionId)?.remove();
    }

    socket.on('qr', ({ sessionId, qr }) => {
      const qrDiv = document.getElementById(`qr-${sessionId}`);
      if (qrDiv) qrDiv.innerHTML = `<img src="${qr}" alt="QR para ${sessionId}" />`;
    });

    socket.on('qr-clear', ({ sessionId }) => {
      const qrDiv = document.getElementById(`qr-${sessionId}`);
      if (qrDiv) qrDiv.innerHTML = 'QR eliminado';
    });

    socket.on('log', (msg) => {
      const logContainer = document.getElementById('activity-log');
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.innerHTML = `
        <span class="log-time">[${new Date().toLocaleTimeString()}]</span>
        <span class="log-message">${msg}</span>
      `;
      logContainer.prepend(entry);
    });
  </script>
</body>
</html>
